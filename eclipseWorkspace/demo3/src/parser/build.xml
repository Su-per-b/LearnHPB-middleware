<?xml version="1.0" encoding="ISO-8859-1"?>
<project name="fmu" default="build" xmlns:cpptasks="antlib:net.sf.antcontrib.cpptasks">
  <import file="../../build-common.xml"/>

  <!-- Clean -->
  <target name="clean" description="Deletes generated files">
    <delete verbose="true">
      <fileset dir="../../obj" includes="*.obj,*.o,*.lib,*.dll,*.exp,*.manifest"/>
      <fileset dir="../../bin" includes="parser*, parser.exe"/>
    </delete>
  </target>

  <target name="cleanObjectFiles" description="Deletes generated object files">
    <delete verbose="true">
      <fileset dir="../../obj" includes="*.obj,*.o"/>
    </delete>
  </target>

  <!-- Compile -->
  <target name="compile" description="Compiles the source">
    <cpptasks:cc runtime="static" name="${cc}" objdir="../../obj">    
      <fileset dir="." includes="*.c"/>      
      <fileset dir="../common" includes="xml_parser_cosim.c, stack.c, util.c"/> 
      <!-- Windows: disable the warning about different 'const' qualifier-->
      <compilerarg value="/wd4090"    if="windows"/>  
    </cpptasks:cc>
  </target>
  
<!-- Link -->
  <target name="link" depends="compile" description="Links the binaries">
    <cpptasks:cc runtime="static" name="${cc}" subsystem="console" outtype="executable" outfile="../../bin/parser">
      <fileset dir="../../obj" includes="*.${extObj}"/>
      <!-- Mac OS X -->
      <libset dir="/usr/lib" libs="expat"       if="mac"/>
      <!-- Linux -->
      <libset dir="/usr/lib" libs="expat"       if="linux"/>
      <!-- Windows -->    
      <libset dir="..\..\lib\windows\expat\lib" libs="libexpatMT"       if="windows"/> 

 </cpptasks:cc>
  </target>

  <!-- Build -->
  <target name="build" depends="link" description="Builds the libraries"/>

  <!-- All -->
  <target name="all" depends="build" description="Runs all targets"/>

</project>
