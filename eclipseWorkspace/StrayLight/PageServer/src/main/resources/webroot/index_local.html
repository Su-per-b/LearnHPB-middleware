
<html>
<head>
<title>WebSocket Test</title>
<script type="text/javascript">


	var remote
	if (!window.WebSocket)
		alert("WebSocket not supported by this browser");

	function $() {
		return document.getElementById(arguments[0]);
	}
	function $F() {
		return document.getElementById(arguments[0]).value;
	}
	function connect() {
		room.connect();
	}
	
	var gallons = 1;

	function getKeyCode(ev) {
		if (window.event)
			return window.event.keyCode;
		return ev.keyCode;
	}
	var convert = {
		gallonsToFootPound : function(gallons) {
			var location = "ws://localhost:8080/"
			this._gallons = gallons;
			this._ws = new WebSocket(location);
			this._ws.onopen = this._onopen;
			this._ws.onmessage = this._onmessage;
			this._ws.onclose = this._onclose;
			this._ws.onerror = this._onerror;
		}
	}
	
	var room = {
		connect : function() {

			
			room.output('establishing connection...');
			
			//var location = "ws://wintermute.rajlab.com:8080/"
			var location = "ws://localhost:8080/"
			
			this._ws = new WebSocket(location);
			this._ws.onopen = this._onopen;
			this._ws.onmessage = this._onmessage;
			this._ws.onclose = this._onclose;
			this._ws.onerror = this._onerror;
		},

		chat : function(text) {
			
			gallons = text;
			
			if (text != null && text.length > 0)
				room._send(text);
				
			room.output('request sent');
		},

		_onopen : function() {			
			$('gallonsButton').disabled = false;
			room.output('connected');
		},
		
		output : function(text) {
				var chat = $('chat');
				var spanFrom = document.createElement('span');
				var spanText = document.createElement('span');
				spanText.className = 'text';
				spanText.innerHTML = text;
				var lineBreak = document.createElement('br');
				chat.appendChild(spanFrom);
				chat.appendChild(spanText);
				chat.appendChild(lineBreak);
				chat.scrollTop = chat.scrollHeight - chat.clientHeight;
		},
		
		_onmessage : function(m) {
			if (m.data) {

				var text = m.data;
				
				text = gallons + ' gallons of gasoline equals ' + text + ' foot pounds of tourque';
				
				room.output(text);
			}
		},

		_onclose : function(m) {
			this._ws = null;

			$('chat').innerHTML = '';
		},

		_onerror : function(e) {
			alert(e);
		},
		
		_send : function( message) {

			if (this._ws)
				this._ws.send(message);
		}
	};
</script>
<style type='text/css'>

body {
	font-family:sans-serif;
}
div {
	border: 0px solid black;
}

div#chat {
	clear: both;
	width: 40em;
	height: 20ex;
	overflow: auto;
	background-color: #f0f0f0;
	padding: 4px;
	border: 1px solid black;
}

div#input {
	clear: both;
	width: 40em;
	padding: 4px;
	background-color: #e0e0e0;
	border: 1px solid black;
	border-top: 0px
}

input#phrase {
	width: 30em;
	background-color: #e0f0f0;
}

input#username {
	width: 14em;
	background-color: #e0f0f0;
}

div.hidden {
	display: none;
}

span.from {
	font-weight: bold;
}
</style>
</head>
<body onload="connect()" >
	<h3>Websockets Test</h3>
	
	<div id="inputGallons">
	
		<div id="gallonsDiv">
			gallons of gasoline:&nbsp;
			<input id="gallonsInput" type="text" value="1"> </input>
			
			<input id="gallonsButton" disabled="true"
				class="button" type="submit" name="gallonsButton" value="Submit" />
				
				
		</div>
		

	</div>
	
	
	<div id="chat"></div>
	

	
	<script type="text/javascript">	

		
		// "Join" button click opens Chat WebSockets
		$('gallonsButton').onclick = function(event) {
		
			room.chat($F('gallonsInput'));
			$('gallonsInput').value = '';
			
			return false;
		};
		
		

	</script>
		
</body>
</html>