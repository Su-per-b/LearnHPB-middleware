
<html>
<head>
<title>WebSocket Test</title>
<script type="text/javascript">



	//var qsParm = new Array();
	//qsParm['socket-server'] = 'straylight';
	//qs();
	

	socketServerUrl = 'none';
	findSocketServer();
	
	function findSocketServer() {

		url = String (window.location)
		console.log('window.location: '+ url)
		
		hostname = url.split('/')[2];
		console.log('hostname: '+ hostname)
		
		socketServerUrl = "ws://" + hostname + ":8080/"
		/*
		if (hostname == 'wintermute') {
			socketServerUrl = "ws://wintermute.rajlab.com:8080/"
		} else if (hostname == 'straylight') {
			socketServerUrl = "ws://straylight.rajlab.com:8080/"
		} else if (hostname == 'localhost') {
			socketServerUrl = "ws://localhost:8080/"
		} else {
			alert ('invalid hostname: ' + hostname);
		}
			*/
			
		
	}
	/*
	
	function qs() {
		var query = window.location.search.substring(1);
		var parms = query.split('&');
		for (var i=0; i<parms.length; i++) {
			var pos = parms[i].indexOf('=');
			if (pos > 0) {
				var key = parms[i].substring(0,pos);
				var val = parms[i].substring(pos+1);
				qsParm[key] = val;
			}	
		}
	}
	*/
	


	var remote
	if (!window.WebSocket)
		alert("WebSocket not supported by this browser");

	function $() {
		return document.getElementById(arguments[0]);
	}
	function $F() {
		return document.getElementById(arguments[0]).value;
	}
	function connect() {
		room.connect();
	}


	function getKeyCode(ev) {
		if (window.event)
			return window.event.keyCode;
		return ev.keyCode;
	}
	

	var room = {
			
		connect : function() {

			room.output('establishing connection to: ' + socketServerUrl);


			
			
			this._ws = new WebSocket(socketServerUrl);
			this._ws.onopen = this._onopen;
			this._ws.onmessage = this._onmessage;
			this._ws.onclose = this._onclose;
			this._ws.onerror = this._onerror;
		},

		chat : function(text) {
			
			gallons = text;
			
			if (text != null && text.length > 0)
				room._send(text);
				
			room.output('request sent');
		},

		_onopen : function() {			
			$('submitButton').disabled = false;
			room.output('connected');
		},
		
		output : function(text) {
				var chat = $('chat');
				var spanFrom = document.createElement('span');
				var spanText = document.createElement('span');
				spanText.className = 'text';
				spanText.innerHTML = text;
				var lineBreak = document.createElement('br');
				chat.appendChild(spanFrom);
				chat.appendChild(spanText);
				chat.appendChild(lineBreak);
				chat.scrollTop = chat.scrollHeight - chat.clientHeight;
		},
		
		_onmessage : function(m) {
			if (m.data) {

				var text = m.data;
				
				//text = gallons + ' gallons of gasoline equals ' + text + ' foot pounds of tourque';
				
				room.output(text);
			}
		},

		_onclose : function(m) {
			this._ws = null;

			$('chat').innerHTML = '';
		},

		_onerror : function(e) {
			alert(e);
		},
		
		_send : function( message) {

			if (this._ws)
				this._ws.send(message);
		}
	};
</script>
<style type='text/css'>

body {
	font-family:sans-serif;
}
div {
	border: 0px solid black;
}

div#chat {
	clear: both;
	width: 90%;
	height: 80ex;
	overflow: auto;
	background-color: #f0f0f0;
	padding: 4px;
	border: 1px solid black;
}

div#input {
	clear: both;
	width: 40em;
	padding: 4px;
	background-color: #e0e0e0;
	border: 1px solid black;
	border-top: 0px
}

input#phrase {
	width: 30em;
	background-color: #e0f0f0;
}

input#username {
	width: 14em;
	background-color: #e0f0f0;
}

div.hidden {
	display: none;
}

span.from {
	font-weight: bold;
}
</style>
</head>
<body onload="connect()" >
	<h3>Simulation Test</h3>
	
	<div>
	
		<div>
			command:&nbsp;
			<input id="commandInput" type="text" value="run"> </input>
		
			<input id="submitButton" disabled="true"
				class="button" type="submit" name="submitButton" value="Submit" />
				
		</div>
		
	</div>
	
		<br />
	<div id="chat"></div>
	

	
	<script type="text/javascript">	

		
		// "Join" button click opens Chat WebSockets
		$('submitButton').onclick = function(event) {
		
			room.chat($F('commandInput'));
			$('commandInput').value = '';
			
			return false;
		};
		
		

	</script>
		
</body>
</html>